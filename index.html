<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather - devTools</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins&display=swap" rel="stylesheet">
    <link rel="icon" href="media/Spikey.png" />
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

</head>
 
<body>
    <div class="hs-elem">
        <h1>devCast</h1>
        <span><i class="col-white">Your Weather Companion</i></span>
    </div>

    <div class="city">
        Enter a city name to get started
    </div>
    <div class="day-date">
        Monday, 27th april 2023
    </div>
    <div class="weather-condition">
    </div>
    <div class="temp">
    </div>
    <div class="summary hidden">
        <div class="widget">
            <img src="media/wind.png" alt="ImageLoadError" class="widget-icon" />
            <i>Wind</i>
            <span class="wind-speed"><i>LOADING</i></span>
        </div>
        <div class="widget">
            <img src="media/humidity.png" alt="ImageLoadError" class="widget-icon" />
            <i>Humidity</i>
            <span class="humidity"><i>LOADING</i></span>
        </div>
        <div class="widget">
            <img src="media/visibility.png" alt="ImageLoadError" class="widget-icon" />
            <i>Visibility</i>
            <span class="visibility"><i>LOADING</i></span>
        </div>
        <div class="widget">
            <img src="media/pressure.png" alt="ImageLoadError" class="widget-icon" />
            <i>Pressure</i>
            <span class="pressure"><i>LOADING</i></span>
        </div>
        <div class="widget">
            <img src="media/feels_like.png" alt="ImageLoadError" class="widget-icon" />
            <i>Feels like</i>
            <span class="feels-like"><i>LOADING</i></span>
        </div>

    </div>


    <div class="alert-container"></div>

    <div class="input">
        <input type="search" class="city-search" placeholder="Enter city name">
        <input type="submit" class="search-btn" onclick="searchWeather()">
    </div>
</body>

<script>
    let alertContainer = document.querySelector('.alert-container');
    let cloudyImage = 'media/cloudy.png';
    const currentDateTime = new Date();
    document.querySelector('.day-date').innerHTML = currentDateTime.toDateString();

    const apiKey = "03cd4fc36e1d31bb8f1d0bc5356f5510";


    function ws_callback() {
        const cityForCoords = document.querySelector('.city-search').value;

        const coordsApiUrl = `https://api.openweathermap.org/geo/1.0/direct?q=${cityForCoords}&appid=${apiKey}`;
        let weatherIcon = document.querySelector('.weather-icon');
        var lat;
        var lon;
        fetch(coordsApiUrl)
            .then(response => response.json())
            .then(data => {
                const location = data[0];
                lat = location.lat;
                lon = location.lon;
                const apiUrl = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`;

                checkWeather(apiUrl);
                const forecastApiUrl = `api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}`;
                checkForecast(forecastApiUrl);

            })
            .catch(error => console.error('Error:', error));

        async function checkForecast(forecastApiUrl) {
            fetch(forecastApiUrl)
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                })

        }

        async function checkWeather(apiUrl) {
            const response = await fetch(apiUrl);
            var data = await response.json();
            document.querySelector('.temp').innerHTML = `${data.main.temp.toFixed()}°C`;
            document.querySelector('.city').innerHTML = data.name;
            document.querySelector('.weather-condition').innerHTML = data.weather[0].main;
            document.querySelector('.wind-speed').innerHTML = `${data.wind.speed}km/h-${data.wind.deg}°`;
            document.querySelector('.humidity').innerHTML = `${data.main.humidity}%`;
            document.querySelector('.visibility').innerHTML = `${data.visibility / 1000}km`;
            document.querySelector('.pressure').innerHTML = `${data.main.pressure}mbar`;
            document.querySelector('.feels-like').innerHTML = `${data.main.feels_like} °C`;

            if (data.weather[0].main == 'Clouds' || data.weather[0].main == 'Smoke') {
                document.body.style.backgroundColor = '#009bb6';
            } else if (data.weather[0].main == 'Clear') {
                if (currentDateTime >= 0 && currentDateTime < 12) {
                    document.body.style.backgroundColor = '#004e5c';
                } else {
                    document.body.style.backgroundColor = '#ffc74f';
                }
            } else if (data.weather[0].main == 'Mist') {
                document.body.style.backgroundColor = '#838383';
            } else {
                document.body.style.backgroundColor = '#004a86';
            }
        }
    }

    function searchWeather() {
        
        document.querySelector('.city').innerHTML = '<span class="col-black">LOADING DATA...</span>'
        ws_callback();
        document.querySelector('.city-search').value = '';
        document.querySelector('.summary').classList.remove('hidden');
    }

</script>

</html>